pipeline{
    agent any
    tools { 
      maven 'M2_HOME' 
      jdk 'JAVA_HOME' 
    }
    stages{
       stage('Git checkout'){
          steps{
              git branch: 'main', url: 'https://github.com/Sudhivya/demo-counter-app.git'
          }
       }
       stage('Unit testing'){
          steps{
              sh 'mvn test'
          }
       }
       stage('integration test'){
          steps{
              sh 'mvn verify -DskipUnitTests'
              
          }
       }
       stage('Maven build'){
          steps{
              sh 'mvn clean install'
              
          }
       }
       stage('static code analysis'){
          steps{
              script{
             withSonarQubeEnv(credentialsId: 'sonar-api') {
             sh 'mvn clean package sonar:sonar'
             }
           }
          }
       }
       stage('Quality Gate status'){
             
             steps{
                 
                  script{
                      
                     waitForQualityGate abortPipeline: false, credentialsId: 'sonar-api'
                  }
              }
          }
   }
}
